<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="style.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.js"></script>
	<script src="common.js"></script>
	<title>RiTHM - Page d'accueil</title>
	
	<script>
	var rest = "http://localhost:1337";
	var roomId = $.getUrlVar('id');
		
	function presentationRoom(data) {
		
		if (data.count == 0) {
				$("#resume").html("<h2>Cette chambre n'existe pas</h2>");
				return;
		}
		
		var room = data.hits[0];
		var content = "<h2>"+ room.nom + "</h2>" +
					'<div class="chambre">' +
			'<figure>' +
				'<img src="images/chambre.jpg" alt="Chambre" width="150" height="150">'
				+ room.description + '</figure>' +
		'</div>';
		$("#resume").html(content);
	}
		
	function presentationPatients(data) {
		
		var content = "<h2>Liste des Patients</h2><ol>";
		for (var i in data.hits) {
			var patient = data.hits[i];
			content += '<div class="patient"><p><a href="patient.html?id='
				+ patient.id + '&roomId=' + roomId + '">' + ((patient.isMan) ? "M" : "Mme") 
				+ " " + patient.nom + '</a></p></div>';
		}
		content += "</ol>";
		
		$("#liste_patients").html(content);
	}
	
	
	$(document).ready(function() {
		
		function getRoom(id) {
			$.post(rest + '/rooms',
			  '{"id":' + id + '}',
			  presentationRoom,
			  "json");
		}
		
		function getPatients(id) {
			$.post(rest + '/patients',
			'{"roomId": ' + id + '}',
			presentationPatients,
			"json");
		}

		getRoom(roomId); // initially retrieves the room infos.
		getPatients(roomId);
	});
	</script>
</head>

<body>

<header id="header" class="branding" role="banner">
	<hgroup>
	<div class="retourTdB">
		<a href="index.html">
		<img src="images/retour.png" alt="retour" width="40" height="40"/>
		</a>
	</div>
	<h1>Room<h1>
	<div class="alerte">
		<!--TODO: ref vers la chambre qui pose probleme !! -->
		<a href="room.html">
		<figure>
			<img src="images/attention2.png" alt="alerte" width="60" height="50">
		</figure>
		</a>
	</div> 
	</hgroup>
</header>

<div id="wrapper">
	
	<section id="resume">
		
	</section>
	
	<section id="liste_patients">
		
	</section>
	
</div>
	
<footer>Copyright 2012 - Hexanome H4311</footer>
	
</body>

</html>
