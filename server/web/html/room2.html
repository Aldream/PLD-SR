<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<link rel="stylesheet" href="global.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.js"></script>
	<script src="common.js"></script>
	<title>RiTHM - Page d'accueil</title>

	
	<script>
	var rest = "http://localhost:1337";
	var roomId = $.getUrlVar('id');
		
	function presentationRoom(data) {
		
		if (data.count == 0) {
				$("#resume").html("<h2>Cette chambre n'existe pas</h2>");
				return;
		}
		
		var room = data.hits[0];
		var content = "<h2>"+ room.nom + "</h2>" +
					'<div class="chambre">' +
			'<figure>' +
				'<img src="images/chambre.jpg" alt="Chambre" width="150" height="150">'
				+ room.description + '</figure>'/* +
				'<p>' + room.*/
		'</div>';
		$("#resume").html(content);
	}
		
	function presentationPatients(data) {
		
		var content = "";
		if (data.hits.length == 0) {
			content += '<li>Pas de patient</li>'
		}
		else {
			for (var i in data.hits) {
				var patient = data.hits[i];
				content += '<a href="patient.html?id='+ patient.id + '&roomId=' + roomId + '"><li class="labelUnselected">' + ((patient.isMan) ? "M." : "Mme.") + " " + patient.nom + '</li></a>';
			}
		}
		$("#liste_patients").html(content);
	}
	
	
	$(document).ready(function() {
		
		function getRoom(id) {
			$.post(rest + '/rooms',
			  (id ? '{"id":' + id + '}' : '{}'),
			  presentationRoom,
			  "json");
		}
		
		function getPatients(id) {
			$.post(rest + '/patients',
			'{"roomId": ' + id + '}',
			presentationPatients,
			"json");
		}

		getRoom(roomId); // initially retrieves the room infos.
		getPatients(roomId);
	});
	</script>
</head>

<body>

<header>
		<div id="logo">
			<h1><a href="index.html">Rithm</a></h1>
		</div>
		<nav>
			<ul>
				<li class="punch" ><a href="index.html" title="Accueil">Accueil</a></li>
				<li class="punch" ><a href="" title="Options">Options</a></li>
				<li class="punch" ><a href="" title="Profil">Profil</a></li>
				<li class="punch" ><a href="notifications.html" title="Notifications"><img src="images/warning2.png" title="Alertes"/> Notifications</a></li>
			</ul> 
		</nav>
</header>

<section>
		<nav>
			<h2>Patients</h2>
			<ul id="liste_patients">
				<li>Chargement en cours ...</li>
			</ul> 
		</nav>
		<article id="resume"></article>
	</section>
	
<footer>H4311 &#169; 2011-12</footer>
	
</body>

</html>
